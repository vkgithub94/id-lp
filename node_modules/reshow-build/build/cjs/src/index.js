"use strict";

var _interopRequireDefault = require("reshow-runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _typeof2 = _interopRequireDefault(require("reshow-runtime/helpers/typeof"));

var _react = require("react");

var _reshowConstant = require("reshow-constant");

var _array = require("array.merge");

var buildFunc = function buildFunc(component, props, child) {
  // anonymous function will call directly
  if (_reshowConstant.FUNCTION === (0, _typeof2["default"])(component) && !component.name) {
    try {
      if (child != null) {
        props.children = child;
      }

      return component(props);
    } catch (e) {
      if (e.name === 'TypeError') {
        return buildReact(component, props, child);
      } else {
        throw e;
      }
    }
  } else {
    return buildReact(component, props, child);
  }
};

var buildReact = function buildReact(component, props, child) {
  var params = [component, props];

  if (child != null) {
    params.push(child);
  }

  return ((0, _react.isValidElement)(component) ? _react.cloneElement : _react.createElement).apply(null, params);
};

var build = function build(component) {
  return function (props, child) {
    if (!component) {
      return null;
    }

    props = (0, _array.removeEmpty)(props, true);

    var run = function run(comp) {
      return ((0, _react.isValidElement)(comp) ? buildReact : buildFunc)(comp, props, child);
    };

    return component.map ? _react.Children.map(component.map(function (comp) {
      return run(comp);
    }), function (c) {
      return c;
    }) : run(component);
  };
};

var _default = build;
exports["default"] = _default;
module.exports = exports.default;